@page "/proveedores/compras/agregar"
@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Components.Forms
@inject NavigationManager Nav

<div class="contenedor">
    <div class="status-bar-safe-area"></div>

    <header class="mb-4">
        <p class="titulo">Nueva Compra</p>
        <p class="descripcion">Gestiona el registro de una nueva adquisición</p>
    </header>

    <EditForm Model="@form" OnValidSubmit="@Guardar">
        <DataAnnotationsValidator />
        <ValidationSummary class="mb-3" />

        <div class="input-container">
            <label class="label">Proveedor</label>
            <InputSelect class="input" @bind-Value="form.ProveedorId">
                <option value="">Seleccionar proveedor</option>
                <option value="1">Distribuidora ABC</option>
                <option value="2">Mayorista de Insumos</option>
                <option value="3">Tecnología Global</option>
            </InputSelect>
            <ValidationMessage For="@(() => form.ProveedorId)" class="validation-message" />
        </div>

        <div class="input-container">
            <label class="label">Fecha de Compra</label>
            <InputDate class="input"
                       @bind-Value="form.FechaCompra" />
            <ValidationMessage For="@(() => form.FechaCompra)" class="validation-message" />
        </div>

        <div class="input-container">
            <label class="label">Usuario Responsable</label>
            <InputSelect class="input" @bind-Value="form.UsuarioId">
                <option value="">Seleccionar usuario</option>
                <option value="101">Admin</option>
                <option value="102">Gerente</option>
            </InputSelect>
            <ValidationMessage For="@(() => form.UsuarioId)" class="validation-message" />
        </div>

        <div class="acciones-footer">
            <button type="button" class="boton-negro"
                    @onclick="@(() => Nav.NavigateTo("/compras"))">
                Cancelar
            </button>
            <button type="submit" class="boton-verde">
                Guardar Compra
            </button>
        </div>
    </EditForm>
</div>

@code {
    // Modelo de datos para el formulario de Agregar Compra
    public class CompraForm
    {
        [Required(ErrorMessage = "El proveedor es requerido")]
        public int? ProveedorId { get; set; }

        [Required(ErrorMessage = "La fecha de compra es requerida")]
        public DateTime? FechaCompra { get; set; } = DateTime.Now.Date;

        [Required(ErrorMessage = "El usuario es requerido")]
        public int? UsuarioId { get; set; }

        // El campo MontoTotal ha sido eliminado de este modelo.
    }

    private readonly CompraForm form = new();

    private void Guardar()
    {
        // *Lógica real:* Aquí se debe llamar a un servicio (API) para guardar 'form' en la base de datos
        Console.WriteLine($"Guardando nueva compra. Proveedor ID: {form.ProveedorId}");

        // Navegación de demo tras guardar exitosamente
        Nav.NavigateTo("/compras");
    }
<<<<<<< Updated upstream
}
=======
}
>>>>>>> Stashed changes
