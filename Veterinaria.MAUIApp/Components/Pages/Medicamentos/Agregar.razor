@page "/medicamentos/agregar"
@inject MedicamentoService medicamentoService
@inject NavigationManager nav
@using Veterinaria.MAUIApplication.Models
@using Veterinaria.MAUIApplication.Services
@using Microsoft.AspNetCore.Components.Forms

<div class="container mt-4">
    <div class="card shadow-sm p-4">
        <h3 class="mb-4">Agregar Medicamento</h3>

        <EditForm Model="@medicamento" OnValidSubmit="Guardar">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="mb-3">
                <InputText class="form-control" @bind-Value="medicamento.Nombre" placeholder="Nombre" />
            </div>
            <div class="mb-3">
                <InputText class="form-control" @bind-Value="medicamento.Formafarmacautica" placeholder="Forma farmacéutica" />
            </div>
            <div class="mb-3">
                <InputText class="form-control" @bind-Value="medicamento.Concentracion" placeholder="Concentración" />
            </div>
            <div class="mb-3">
                <InputText class="form-control" @bind-Value="medicamento.Unidad" placeholder="Unidad" />
            </div>
            <div class="mb-3">
                <InputText class="form-control" @bind-Value="medicamento.Via" placeholder="Vía" />
            </div>

            <div class="form-check mb-3">
                <InputCheckbox class="form-check-input" @bind-Value="medicamento.RequiereReceta" />
                <label class="form-check-label">Requiere Receta</label>
            </div>
            <div class="form-check mb-3">
                <InputCheckbox class="form-check-input" @bind-Value="medicamento.Activo" />
                <label class="form-check-label">Activo</label>
            </div>

            <div class="mb-3">
                <InputText class="form-control" @bind-Value="medicamento.Temperaturaalm" placeholder="Temperatura Almacenamiento" />
            </div>
            <div class="mb-3">
                <label>Vida útil (meses):</label>
                <InputNumber class="form-control" @bind-Value="medicamento.Vidautilmeses" />
            </div>

            <div class="d-flex justify-content-between mt-4">
                <button class="btn btn-outline-secondary" type="button" @onclick="Cancelar">Cancelar</button>
                <button class="btn btn-success" type="submit">Guardar</button>
            </div>
        </EditForm>
    </div>
</div>

@code {
    private Medicamento medicamento = new();

    private async Task Guardar()
    {
        bool ok = await medicamentoService.Create(medicamento);
        if (ok)
        {
            nav.NavigateTo("/medicamentos?mensaje=agregado");
        }
        else
        {
            Console.WriteLine("Error al agregar el medicamento.");
        }
    }

    private void Cancelar()
    {
        nav.NavigateTo("/medicamentos");
    }
}